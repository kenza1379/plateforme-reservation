{% extends "client/base.html" %}
{% load static %}

{% block title %}Mon compte - Param√®tres de s√©curit√©{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'client/css/mon_compte.css' %}">
{% endblock %}

{% block content %}
<div class="account-container">

    <!-- Messages -->
    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="breadcrumb-nav">
        <a href="{% url 'accueil' %}" class="breadcrumb-home">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
            </svg>
        </a>
        <span>‚Ä∫</span>
        <a href="{% url 'mon_compte' %}">Mon compte</a>
        <span>‚Ä∫</span>
        <span>Param√®tres de s√©curit√©</span>
    </div>

    <div class="account-layout">

        <!-- Sidebar -->
        <div class="sidebar">
            <a href="{% url 'mon_compte' %}" class="sidebar-item">
                <div class="sidebar-icon">üë§</div>
                <span>Informations personnelles</span>
            </a>

            <a href="{% url 'security_settings' %}" class="sidebar-item active">
                <div class="sidebar-icon">üîí</div>
                <span>Param√®tres de s√©curit√©</span>
            </a>

            <a href="{% url 'payment_methods' %}" class="sidebar-item">
                <div class="sidebar-icon">üí≥</div>
                <span>Moyens de paiement</span>
            </a>
        </div>

        <!-- Main content -->
        <div class="main-content">
            <div class="content-header">
                <h1>Param√®tres de s√©curit√©</h1>
                <p>G√©rez vos mots de passe, vos sessions actives et la suppression de votre compte.</p>
            </div>

            <!-- Mot de passe -->
            <div class="info-row">
                <div class="info-label">Mot de passe</div>
                <div class="info-value">
                    <div>‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                    <div class="info-description">Modifiez votre mot de passe r√©guli√®rement pour renforcer la s√©curit√©.</div>
                </div>
                <button type="button" class="modify-btn" data-target="passwordModal">Modifier</button>
            </div>

            <!-- Sessions -->
            <div class="info-row">
                <div class="info-label">Sessions actives</div>
                <div class="info-value">
                    <div>Vous √™tes connect√© depuis {{ user.active_sessions.count }} appareil(s).</div>
                    <div class="info-description">D√©connectez les appareils que vous ne reconnaissez pas.</div>
                </div>
                <button type="button" class="modify-btn" data-target="sessionsModal">G√©rer</button>
            </div>

            <!-- Supprimer compte -->
            <div class="info-row">
                <div class="info-label">Supprimer le compte</div>
                <div class="info-value">
                    <div class="info-description">Supprime d√©finitivement votre compte et toutes les donn√©es associ√©es.</div>
                </div>
                <button type="button" class="modify-btn danger" data-target="deleteAccountModal">Supprimer</button>
            </div>
        </div>
    </div>
</div>

<!-- ================== MODALS ================== -->

<!-- üîê Mot de passe -->
<div id="passwordModal" class="modal-custom">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Changer le mot de passe</h2>
            <button class="close-btn" data-close>&times;</button>
        </div>

        <form method="POST" action="{% url 'change_password' %}">
            {% csrf_token %}
            <div class="form-group">
                <label>Nouveau mot de passe</label>
                <input type="password" name="new_password" class="form-control" required>
            </div>

            <div class="form-group">
                <label>Confirmer le mot de passe</label>
                <input type="password" name="confirm_password" class="form-control" required>
            </div>

            <div class="modal-actions">
                <button type="submit" class="btn-primary-custom">Enregistrer</button>
                <button type="button" class="btn-cancel" data-close>Annuler</button>
            </div>
        </form>
    </div>
</div>

<!-- üîê Sessions actives -->
<div id="sessionsModal" class="modal-custom">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Sessions actives</h2>
            <button class="close-btn" data-close>&times;</button>
        </div>

        <ul>
            {% for session in user.active_sessions.all %}
            <li>
                {{ session.device_info }} ‚Äî {{ session.last_activity|date:"d/m/Y H:i" }}
                <form method="POST" action="{% url 'logout_session' session.session_key %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-cancel">D√©connecter</button>
                </form>
            </li>
            {% empty %}
            <li>Aucune session active.</li>
            {% endfor %}
        </ul>
    </div>
</div>

<!-- ‚ùå Supprimer compte -->
<div id="deleteAccountModal" class="modal-custom">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Supprimer mon compte</h2>
            <button class="close-btn" data-close>&times;</button>
        </div>

        <form method="post" action="{% url 'delete_account' %}">
            {% csrf_token %}
            <p>Pour confirmer, entrez votre mot de passe.</p>

            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" name="confirm_password" class="form-control" required>
            </div>

            <div class="modal-actions">
                <button type="submit" class="btn-primary-custom">Supprimer mon compte</button>
                <button type="button" class="btn-cancel" data-close>Annuler</button>
            </div>
        </form>
    </div>
</div>

<script src="{% static 'client/script.js' %}"></script>
{% endblock %}
