{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nouveau mot de passe</title>
    <link rel="stylesheet" href="{% static 'users/css/style.css' %}">
</head>
<body>
    <div class="soft-background">
        <div class="floating-shapes">
            <div class="soft-blob blob-1"></div>
            <div class="soft-blob blob-2"></div>
            <div class="soft-blob blob-3"></div>
            <div class="soft-blob blob-4"></div>
        </div>
    </div>

    <div class="login-container">
        <div class="soft-card">
            <div class="comfort-header">
                <div class="gentle-logo">
                    <div class="logo-circle">
                        <div class="comfort-icon">
                            <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                                <path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2z" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                <path d="M16 10v8m0 4h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <h1 class="comfort-title">Nouveau mot de passe</h1>
                <p class="gentle-subtitle">Choisissez un mot de passe sécurisé</p>
            </div>
            
            <form class="comfort-form" method="post">
                {% csrf_token %}
                
                {% if validlink %}
                    <div class="soft-field">
                        <div class="field-container">
                            <input type="password" id="new_password1" name="new_password1" required autocomplete="new-password">
                            <label for="new_password1">Nouveau mot de passe</label>
                            <button type="button" class="gentle-toggle" id="passwordToggle1" aria-label="Afficher/masquer le mot de passe">
                                <div class="toggle-icon">
                                    <svg class="eye-open" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M10 3c-4.5 0-8.3 3.8-9 7 .7 3.2 4.5 7 9 7s8.3-3.8 9-7c-.7-3.2-4.5-7-9-7z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                        <circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                    </svg>
                                    <svg class="eye-closed" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M3 3l14 14M8.5 8.5a3 3 0 004 4m2.5-2.5C15 10 12.5 7 10 7c-.5 0-1 .1-1.5.3M10 13c-2.5 0-4.5-2-5-3 .3-.6.7-1.2 1.2-1.7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="soft-field">
                        <div class="field-container">
                            <input type="password" id="new_password2" name="new_password2" required autocomplete="new-password">
                            <label for="new_password2">Confirmer le mot de passe</label>
                            <button type="button" class="gentle-toggle" id="passwordToggle2" aria-label="Afficher/masquer le mot de passe">
                                <div class="toggle-icon">
                                    <svg class="eye-open" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M10 3c-4.5 0-8.3 3.8-9 7 .7 3.2 4.5 7 9 7s8.3-3.8 9-7c-.7-3.2-4.5-7-9-7z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                        <circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                    </svg>
                                    <svg class="eye-closed" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M3 3l14 14M8.5 8.5a3 3 0 004 4m2.5-2.5C15 10 12.5 7 10 7c-.5 0-1 .1-1.5.3M10 13c-2.5 0-4.5-2-5-3 .3-.6.7-1.2 1.2-1.7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </div>

                    {% if form.errors %}
                        <div class="gentle-error" style="text-align: center; margin-bottom: 16px;">
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    {{ error }}<br>
                                {% endfor %}
                            {% endfor %}
                        </div>
                    {% endif %}

                    <button type="submit" class="comfort-button">
                        <span class="button-text">Réinitialiser le mot de passe</span>
                    </button>
                {% else %}
                    <div class="gentle-error" style="text-align: center; padding: 20px;">
                        <p>⚠️ Ce lien de réinitialisation est invalide ou a expiré.</p>
                        <p style="margin-top: 10px;">
                            <a href="{% url 'login' %}" class="comfort-link">Retour à la connexion</a>
                        </p>
                    </div>
                {% endif %}
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle pour le premier champ
            const toggle1 = document.getElementById('passwordToggle1');
            const input1 = document.getElementById('new_password1');
            
            if (toggle1 && input1) {
                toggle1.addEventListener('click', () => {
                    const type = input1.type === 'password' ? 'text' : 'password';
                    input1.type = type;
                    toggle1.classList.toggle('active');
                });
            }

            // Toggle pour le second champ
            const toggle2 = document.getElementById('passwordToggle2');
            const input2 = document.getElementById('new_password2');
            
            if (toggle2 && input2) {
                toggle2.addEventListener('click', () => {
                    const type = input2.type === 'password' ? 'text' : 'password';
                    input2.type = type;
                    toggle2.classList.toggle('active');
                });
            }
        });
    </script>
</body>
</html>